SML.di("./DSWSCRFk.js",import.meta.url,"DSWSCRFk");SML.di("./DAgRafdt.js",import.meta.url,"DAgRafdt");SML.di("./OAEZpqSu.js",import.meta.url,"OAEZpqSu");
SML.dm("wFWqStN3",["DSWSCRFk","DAgRafdt","OAEZpqSu"],(async(e,t,i)=>{let a=class extends e.s{constructor(){super(...arguments),this.userId=null,this.isModGuidanceEnabled=!1,this.isProgressToastFeatureActivated=!1,this.pubsub=new t.f(this),this.achievementNotificationSubscriptionController=new t.bt(this),this.onAchievementNotificationRecieved=async e=>{if(e&&"achievements"===e.gameID){this.isModGuidanceEnabled&&this.pubsub.publish(t.T.ReloadModGuidanceAchievements);try{const e=await t.r({operation:t.O.AchievementUnlockedNotifications,variables:{maxImageWidth:32}}),a=[],s=e.data.identity?.redditor.trophyCase?.notifications;s?.forEach((e=>{if(a.push(e.id),"StreakExtendedNotification"===e.__typename)this.activateProgressToast({open:!0,notificationType:i.cn.STREAK_EXTENDED,streakLength:e.length});else if("TrophyProgressedNotification"===e.__typename){const t=e.trophy;"AchievementImageTrophy"===t.__typename&&this.activateProgressToast({open:!0,notificationType:i.cn.TROPHY_PROGRESSED,numberCompleted:t.progress?.done,total:t.progress?.total,progressUnit:t.progress?.unit,imgSrc:t.lockedImage.url,achievementId:t.id})}else if("TrophyUnlockedNotification"===e.__typename){const t=e.trophy;"AchievementImageTrophy"!==t.__typename&&"AchievementRepeatableImageTrophy"!==t.__typename||this.activateProgressToast({open:!0,notificationType:i.cn.TROPHY_UNLOCKED,message:t.name,imgSrc:t.lockedImage.url,unlockedImgSrc:t.gridImage.url,achievementId:t.id})}})),a&&a.length>0&&this.deleteAchievementNotifications(a)}catch(e){window.Sentry?.captureError?.(e)}}},this._activateFeature=async e=>t.d(e)}async activateProgressToast(e){if(!this.getIsAchievementsUpdatesEnabled())return;const i=!!document.querySelector("achievement-progress-toast");if(!this.isProgressToastFeatureActivated&&!i)try{this.isProgressToastFeatureActivated=!0,await this._activateFeature({name:t.gp})}catch(e){this.isProgressToastFeatureActivated=!1}this.pubsub.publish(t.T.AchievementsProgressToast,e)}getIsAchievementsUpdatesEnabled(){try{if(!t.K.isAvailable())return!0;const e=t.K.getItem(`${t.N.AchievementsUpdatesEnabled}-${this.userId}`);return null===e||JSON.parse(e)}catch(e){window.Sentry?.captureError?.(e)}return!0}async connectedCallback(){super.connectedCallback(),this.getIsAchievementsUpdatesEnabled()&&this.subscribeToAchievementNotifications(),t.K.isAvailable()&&t.K.getItem(t.N.AchievementsStore)===`${this.userId}-${t.gq.Enrolled}`||this.enrollUserIntoAchievements()}async deleteAchievementNotifications(e){try{await t.r({operation:t.O.DeleteAchievementNotifications,variables:{ids:e}})}catch(e){window.Sentry?.captureError?.(e)}}async enrollUserIntoAchievements(){try{const e=await t.r({operation:t.O.EnrollInStreaks,variables:{input:{timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,gameId:"achievements"}}}),i=e.data?.enrollInGamification?.ok;if(!i)return;t.K.isAvailable()&&t.K.setItem(t.N.AchievementsStore,`${this.userId}-${e.data?.enrollInGamification?.status||""}`)}catch(e){window.Sentry?.captureError?.(e)}}subscribeToAchievementNotifications(){try{this.achievementNotificationSubscriptionController.subscribe({query:{operationName:"SubscribeSubscription",query:"\n            subscription SubscribeSubscription($input: SubscribeInput!) {\n              subscribe(input: $input) {\n                ... on BasicMessage {\n                  data {\n                    ... on GamificationAccomplishmentsMessageData {\n                      gameID\n                    }\n                  }\n                }\n              }\n            }\n            ",variables:{input:{channel:{teamOwner:"I18N",category:"GAMIFICATION",userID:this.userId}}}},onData:async e=>{this.onAchievementNotificationRecieved(e?.data?.subscribe.data)}})}catch(e){window.Sentry?.captureError?.(e)}}render(){return e.x``}};a.styles=[t.t],e._([e.n({type:String,attribute:"user-id"})],a.prototype,"userId",void 0),e._([e.n({type:Boolean,attribute:"mod-guidance-enabled"})],a.prototype,"isModGuidanceEnabled",void 0),a=e._([e.c("achievement-events")],a)}));