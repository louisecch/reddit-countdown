SML.di("./DSWSCRFk.js",import.meta.url,"DSWSCRFk");SML.di("./Bx9dp7xe.js",import.meta.url,"Bx9dp7xe");SML.di("./DAgRafdt.js",import.meta.url,"DAgRafdt");SML.di("./DDc9KuQK.js",import.meta.url,"DDc9KuQK");SML.di("./mLeBs957.js",import.meta.url,"mLeBs957");SML.di("./OHC4dymT.js",import.meta.url,"OHC4dymT");SML.di("./JgxTRdqO.js",import.meta.url,"JgxTRdqO");SML.di("./CnL37q4H.js",import.meta.url,"CnL37q4H");SML.di("./DxvZ7Xss.js",import.meta.url,"DxvZ7Xss");SML.di("./alLlRaWG.js",import.meta.url,"alLlRaWG");SML.di("./BP7JtdRP.js",import.meta.url,"BP7JtdRP");SML.di("./Dj1DJbmt.js",import.meta.url,"Dj1DJbmt");SML.di("./BaPgoYnS.js",import.meta.url,"BaPgoYnS");SML.di("./B8bCssFV.js",import.meta.url,"B8bCssFV");SML.di("./B_Z23SiP.js",import.meta.url,"B_Z23SiP");SML.di("./DvsbXjsy.js",import.meta.url,"DvsbXjsy");SML.di("./BjRhnMPP.js",import.meta.url,"BjRhnMPP");SML.di("./OAEZpqSu.js",import.meta.url,"OAEZpqSu");SML.di("./DjoKwtwQ.js",import.meta.url,"DjoKwtwQ");SML.di("./CU4mObWU.js",import.meta.url,"CU4mObWU");SML.di("./Dnwr24bF.js",import.meta.url,"Dnwr24bF");SML.di("./Vy1IDB19.js",import.meta.url,"Vy1IDB19");SML.di("./BVLgyhDE.js",import.meta.url,"BVLgyhDE");
SML.dm("RTEmqXWu",["DSWSCRFk","Bx9dp7xe","DAgRafdt","DDc9KuQK","mLeBs957","OHC4dymT","JgxTRdqO","CnL37q4H","DxvZ7Xss","alLlRaWG","BP7JtdRP","Dj1DJbmt","BaPgoYnS","B8bCssFV","B_Z23SiP","DvsbXjsy","BjRhnMPP","OAEZpqSu","DjoKwtwQ","CU4mObWU","Dnwr24bF","Vy1IDB19","BVLgyhDE"],(async(t,e,a,i,n,s,o)=>{var r;!function(t){t.GREAT="great",t.NOT_GREAT="not great"}(r||(r={}));let l=class extends t.s{constructor(){super(...arguments),this.otherReasonFormValue="",this.isOpen=!1,this.handleDismiss=()=>{a.a(this,s.p()),this.close()}}show(){a.a(this,s.o()),this.faceplateDialog?.showModal?.(),this.isOpen=!0}close(){this.faceplateDialog?.close?.(),this.isOpen=!1,this.selectedOption=void 0,this.otherReasonFormValue=""}showThankYouAlert(){this.dispatchEvent(a.c("faceplate-alert",{level:a.I.success,message:"Thanks for rating"}))}handleUpvoteTranslation(){this.selectedOption=r.GREAT}handleDownvoteTranslation(){this.selectedOption=r.NOT_GREAT}handleSubmit(){this.selectedOption&&(a.a(this,s.q({reason:this.selectedOption,survey_text:this.otherReasonFormValue})),this.showThankYouAlert(),this.close())}render(){return t.x` <faceplate-dialog id="global-translation-feedback-faceplate-dialog" class="translation-feedback"> <div class="flex flex-col gap-lg"> <div class="flex justify-between"> <h3 class="font-bold text-24 text-neutral-content-strong m-0" data-testid="modal-title"> ${"Enjoying these translations?"} </h3> ${a.J({attributes:{onclick:this.handleDismiss},appearance:"secondary",leadingIcon:t.N({size:t.q.Medium}),size:a.a2.Medium})} </div> <p class="m-0" data-testid="modal-subtitle"> ${"Tell us what you think about your translated Reddit experience."} </p> <div class="flex justify-center gap-md"> <button data-testid="upvote-translation" class="py-md px-lg cursor-pointer border-none rounded-md ${this.selectedOption===r.GREAT?"bg-neutral-background-selected":"bg-neutral-background-medium"}" @click="${this.handleUpvoteTranslation}" @keydown="${this.handleUpvoteTranslation}"> <img src="${CLIENT_CONFIG.STATIC_BASE_URL}assets/snoomojis/Snoo_Expression_Smile_EyesOpen.png" class="block m-auto pb-xs" width="56" height="56" alt=""> <p class="font-semibold text-14 text-center text-neutral-content-strong m-0"> ${"Great"} </p> </button> <button data-testid="downvote-translation" class="py-md px-lg cursor-pointer border-none rounded-md ${this.selectedOption===r.NOT_GREAT?"bg-neutral-background-selected":"bg-neutral-background-medium"}" @click="${this.handleDownvoteTranslation}" @keydown="${this.handleDownvoteTranslation}"> <img src="${CLIENT_CONFIG.STATIC_BASE_URL}assets/snoomojis/Snoo_Expression_Blanc.png" class="block m-auto pb-xs" width="56" height="56" alt=""> <p class="font-semibold text-14 text-center text-neutral-content-strong m-0"> ${"Not Great"} </p> </button> </div> ${this.selectedOption?t.x` <div class="flex w-full box-border"> <faceplate-textarea-input data-testid="other-reason-input" maxlength="500" appearance="${n.a.BORDERED}" size="${n.T.EXPANDED}" @keyup="${t=>{t.stopPropagation(),this.otherReasonFormValue=t.target.value}}" class="w-full" .value="${this.otherReasonFormValue}"> <span slot="label">${"Leave a comment (optional)"}</span> </faceplate-textarea-input> </div> `:t.x``} <div class="flex justify-end"> ${a.J({appearance:"primary",size:a.a2.Large,shape:"pill",attributes:{onclick:this.handleSubmit,className:"flex box-border","data-testid":"submit-feedback-button",disabled:!this.selectedOption},children:t.x`<span class="font-semibold text-14">${"Give Feedback"}</span>`})} </div> </div> </faceplate-dialog> `;}};l.styles=[t.i`.translation-feedback{border-radius:16px;max-width:400px;padding:2rem 1.5rem 1.5rem 1.5rem;width:82%}`,a.t],t._([t.D("#global-translation-feedback-faceplate-dialog")],l.prototype,"faceplateDialog",void 0),t._([t.b()],l.prototype,"selectedOption",void 0),t._([t.b()],l.prototype,"otherReasonFormValue",void 0),t._([t.b()],l.prototype,"isOpen",void 0),l=t._([t.c("global-translation-feedback-modal")],l);const d="data-protection-consent",c="faceplate-bottom-sheet#xpromo-bottom-sheet",u="faceplate-modal#blocking-modal",h=t.s;function m(t){return!!t?.open}let p=class extends h{constructor(){super(...arguments),this.activatableFeatures=[a.g_,a.g$,a.h0,a.h1],this.isDesktop=!1,this.withFeedback=!1,this.withActivatedFeatures=!1,this.translationContextValue=a.ar,this.withCoachmark=!1,this.withTranslationSettings=!1,this.userLocale="",this.hasCoachmarkDisplayLimit=!1,this.translationActiveMsg="Translations enabled",this.handleTranslationActiveSwitch=()=>{const t=!this.translationContextValue.isTranslationActive;this.dispatchContextUpdateEvent({isTranslationActive:t})},this.closeTranslationCoachmark=()=>{this.translationCoachmark?.hide?.(),this.onCoachmarkClose()},this.openTranslationCoachmark=()=>{a.a(this,o.e(!!this.translationContextValue.isTranslationActive)),this.translationCoachmark?.show?.()},this.openTranslationMenu=()=>{a.a(this,o.f(!!this.translationContextValue.isTranslationActive)),this.isDesktop?this.translationDropdownMenu?.show?.():this.translationMenuBottomSheet?.showModal?.()},this.closeTranslationMenu=()=>{a.a(this,o.f(!!this.translationContextValue.isTranslationActive)),this.isDesktop?this.translationDropdownMenu?.close?.():this.translationMenuBottomSheet?.close?.()},this.openFeedbackModal=()=>{this.translationFeedbackModal?.show?.()},this.handleCoachmarkSettingsClick=()=>{this.closeTranslationCoachmark(),this.openTranslationMenu(),a.a(this,o.g(o.h.UpdateSettings))},this.handleTranslationActiveClick=t=>{t.stopPropagation(),a.a(this,s.u(!!this.translationContextValue.isTranslationActive,this.userLocale))},this.handleCoachmarkClick=t=>{t.stopPropagation()},this.handleCoachmarkCloseClick=()=>{this.closeTranslationCoachmark(),a.a(this,o.g(o.h.Dismiss))},this.handleNavMobileButtonClick=()=>{this.activateFeatures(),this.openTranslationMenu(),a.a(this,o.i(!!this.translationContextValue.isTranslationActive))},this.handleNavbarButtonClick=()=>{this.activateFeatures(),a.a(this,o.i(!!this.translationContextValue.isTranslationActive)),a.a(this,o.f(!!this.translationContextValue.isTranslationActive))},this.handleGiveFeedbackButtonClick=()=>{this.openFeedbackModal(),this.closeTranslationMenu()},this.onCoachmarkClose=()=>{setTimeout((()=>{this.dispatchContextUpdateEvent({shouldDisplayCoachmark:!1,shouldDisplayFeedbackCoachmark:!0})}),500)},this._activateFeature=a.d}connectedCallback(){super.connectedCallback();"mtseo-disabled"===a.K.getItem(a.N.I18nTranslationInterventionShown)&&(setTimeout((()=>{this.dispatchEvent(a.c("faceplate-alert",{level:a.I.success,message:"Translations are disabled."}))}),1e3),a.K.setItem(a.N.I18nTranslationInterventionShown,"true"))}updated(t){this.withCoachmark&&!this.hasCoachmarkDisplayLimit&&t.has("translationContextValue")&&void 0!==this.translationContextValue.isTranslationActive&&this.displayCoachmark()}displayCoachmark(){const{coachmarkDisplayCount:t,shouldDisplayCoachmark:e}=this.translationContextValue;window.setTimeout((()=>{if(!e)return;if(this.hasCoachmarkObstacles())return;const a=t<1;this.dispatchContextUpdateEvent({coachmarkDisplayCount:t+1,shouldDisplayCoachmark:a,shouldDisplayFeedbackCoachmark:!a}),a&&this.openTranslationCoachmark(),this.hasCoachmarkDisplayLimit=!0}),1500)}hasCoachmarkObstacles(){const t=!!document.querySelector(d),e=function(t){const e=document.querySelector(t);return e?a.cd(m,e):[]}(c),i=!!document.querySelector(u);return t||e?.length>0||i}dispatchContextUpdateEvent(t){const e={...this.translationContextValue,...t},a=new CustomEvent("update-translation-context",{bubbles:!0,composed:!0,detail:e});this.dispatchEvent(a)}featureShouldBeActivated(t){return!!document.querySelector(`faceplate-loader[name=${t}]`)&&!!document.querySelector(`faceplate-partial[name=${t}]`)&&!a.h2(t)}activateFeatures(){return this.withActivatedFeatures?Promise.all(this.activatableFeatures.filter(this.featureShouldBeActivated).map((t=>this._activateFeature({name:t})))):Promise.resolve()}renderCoachmark(){return this.translationContextValue.shouldDisplayCoachmark?t.x`<rpl-coachmark-card slot="content" appearance="inverted"> ${t.bM({size:t.q.Small,attributes:{slot:"title-icon"}})} <span slot="title" class="whitespace-nowrap">${this.translationActiveMsg}</span> <p class="max-w-[10rem] xs:max-w-none"> ${this.translationContextValue.isTranslationActive?"Posts and comments are automatically translated":"Automatically translate posts and comments"} </p> ${a.J({attributes:{"aria-label":"Close",id:"coachmark-close-button",onclick:this.handleCoachmarkCloseClick,slot:"close-button"},appearance:"plainInverted",leadingIcon:t.N({size:t.q.Small}),size:a.a2.Small})} ${a.J({attributes:{slot:"primary-button",id:"coachmark-settings-button",onclick:this.handleCoachmarkSettingsClick},children:"Settings",appearance:"plainInverted",size:a.a2.Small})} </rpl-coachmark-card>`:t.x``;}renderDesktopMenu(){return t.x`<faceplate-dropdown-menu position="bottom-end" id="translation-desktop-menu"> ${a.J({size:a.a2.Medium,appearance:"plain",shape:"pill",leadingIcon:t.aj({size:t.q.Medium}),attributes:{id:"translation-menu-button","aria-label":this.translationActiveMsg,onclick:this.handleNavbarButtonClick}})} <faceplate-menu slot="menu" dropdown hidden> ${i.l({label:t.x` <faceplate-switch-input id="hui-translation-switch" appearance="${e.S.PRIMARY}" class="inline-flex flex-row-reverse gap-sm" ?checked="${this.translationContextValue.isTranslationActive}" @input="${this.handleTranslationActiveSwitch}" @click="${this.handleTranslationActiveClick}"> <span class="-ml-xs">${this.translationActiveMsg}</span> </faceplate-switch-input> `,size:i.L.Medium})} ${this.withTranslationSettings?i.l({label:t.x` <span class="flex flex-row items-center"> ${t.bE({size:t.q.Medium})} <span class="ml-xs"> ${"Translation Settings"} </span> </span> `,attributes:{id:"translation-settings-list-item"},size:i.L.Medium,href:"/settings/preferences"}):t.A} ${this.withFeedback?i.l({label:"Give translation feedback",attributes:{"data-testid":"hui-translation-button-feedback-option"},size:i.L.Medium,onClick:this.handleGiveFeedbackButtonClick}):t.A} </faceplate-menu> </faceplate-dropdown-menu>`;}renderMobileMenu(){return t.x`<div> ${a.J({size:a.a2.Medium,appearance:"plain",shape:"pill",leadingIcon:t.aj({size:t.q.Medium}),attributes:{id:"translation-menu-button",onclick:this.handleNavMobileButtonClick,"aria-label":this.translationActiveMsg}})} <faceplate-bottom-sheet id="translation-mobile-menu"> <div class="p-md flex flex-col items-stretch w-full gap-md"> <faceplate-switch-input id="hui-translation-switch" appearance="${e.S.PRIMARY}" class="flex flex-row-reverse justify-between gap-sm px-xs" ?checked="${this.translationContextValue.isTranslationActive}" @input="${this.handleTranslationActiveSwitch}" @click="${this.handleTranslationActiveClick}"> <span class="inline-flex items-center gap-xs"> ${t.aj({size:t.q.Medium})} <span> ${this.translationActiveMsg} </span> </span> </faceplate-switch-input> ${this.withFeedback?i.l({label:"Give translation feedback",attributes:{"data-testid":"hui-translation-button-feedback-option"},size:i.L.Medium,onClick:this.handleGiveFeedbackButtonClick}):t.A} </div> </faceplate-bottom-sheet> </div>`;}render(){return t.x` <rpl-coachmark placement="${this.isDesktop?"bottom-end":"bottom"}" appearance="inverted" id="translation-coachmark" @click="${this.handleCoachmarkClick}" @rpl-coachmark:after-hide="${this.onCoachmarkClose}" style="--max-width:fit-content"> <div>${this.isDesktop?this.renderDesktopMenu():this.renderMobileMenu()}</div> ${this.renderCoachmark()} </rpl-coachmark> ${this.withFeedback?t.x` <global-translation-feedback-modal id="hui-translation-button-feedback-modal"></global-translation-feedback-modal>`:t.A} `}};p.styles=[a.t],t._([t.n({type:Boolean,attribute:"is-desktop"})],p.prototype,"isDesktop",void 0),t._([t.n({type:Boolean,attribute:"with-feedback"})],p.prototype,"withFeedback",void 0),t._([t.n({type:Boolean,attribute:"with-activated-features"})],p.prototype,"withActivatedFeatures",void 0),t._([a.aq({context:a.as,subscribe:!0}),t.b()],p.prototype,"translationContextValue",void 0),t._([t.n({type:Boolean,attribute:"with-coachmark"})],p.prototype,"withCoachmark",void 0),t._([t.n({type:Boolean,attribute:"with-translation-settings"})],p.prototype,"withTranslationSettings",void 0),t._([t.n({type:String,attribute:"user-locale"})],p.prototype,"userLocale",void 0),t._([t.b()],p.prototype,"hasCoachmarkDisplayLimit",void 0),t._([t.D("#translation-coachmark")],p.prototype,"translationCoachmark",void 0),t._([t.D("#translation-desktop-menu")],p.prototype,"translationDropdownMenu",void 0),t._([t.D("#translation-mobile-menu")],p.prototype,"translationMenuBottomSheet",void 0),t._([t.D("#hui-translation-button-feedback-modal")],p.prototype,"translationFeedbackModal",void 0),p=t._([t.c("hui-translation-button")],p);const k="second_default",T="enabled_initialized";let v=class extends t.s{constructor(){super(...arguments),this.translationContextValue=a.ar,this.isNewAccountAge=!1,this.isNewImmersiveVisit=!1,this.withBackendSetting=!1,this.preferredLanguages="",this.fullPreferredLanguages="",this.defaultImmersiveOn=!1,this.requestClientGQL=a.r}connectedCallback(){super.connectedCallback(),this.isSettingInitialized()?this.syncTranslationSettingsWithCookie():this.initializeTranslationSettings(),this.initializePreferredLanguageSettings()}updated(t){if(!t.has("translationContextValue")||!this.withBackendSetting)return;const e=t.get("translationContextValue"),a=this.translationContextValue.isTranslationActive,i=e?.isTranslationActive;if(void 0===i)return;(!0!==i&&!0===a||!1!==i&&!1===a)&&this.saveTranslationSettingInAccount(a)}async initializePreferredLanguageSettings(){const t=this.fetchTranslationSettingFromCookie(),e=t&&(t.multilingualState===k||t.multilingualState===T);if(!this.fullPreferredLanguages&&!this.preferredLanguages||!this.withBackendSetting||e)return;const i={...this.translationContextValue};let n;const o=!!this.fullPreferredLanguages&&this.fullPreferredLanguages.length>0;try{const{data:t}=await this.requestClientGQL({operation:a.O.TranslationPreferredLanguages}),e=t?.identity?.preferences?.preferredLanguages||[];if(n=this.defaultPreferredLanguageDecider(e),n&&(o||0===e.length)){const t=(await this.requestClientGQL({operation:a.O.UpdatePreferredLanguagesPreference,variables:{input:{languages:n}}})).data.updatePreferredLanguagesPreference;t?.ok?(a.a(this,s.v("success",n,"",o?k:"")),i.multilingualState=o?k:T,this.dispatchContextUpdateEvent(i)):a.a(this,s.v("failure",n,`GQL update error: ${t?.errors}`))}else!o&&e.length>0&&(i.multilingualState=T,this.dispatchContextUpdateEvent(i))}catch(t){const{message:e}=t;a.a(this,s.v("failure",n||[],`Exception thrown: ${e}`))}}defaultPreferredLanguageDecider(t){return this.fullPreferredLanguages&&this.fullPreferredLanguages.length>0?t?[...new Set([...this.fullPreferredLanguages.split(","),...t])]:t:this.preferredLanguages&&this.preferredLanguages.length>0?[this.preferredLanguages]:null}async initializeTranslationSettings(){const t=this.fetchTranslationSettingFromCookie(),e=await this.fetchTranslationSettingFromGQL();let i,n={...this.translationContextValue};if(t&&(n={...n,...t}),null!==e&&e!==t?.isTranslationActive&&(n={...n,isTranslationActive:e},i=s.T.BACKEND),null===t&&null===e){const[t,e]=this.getFallbackIsTranslationActive();i=e,n={...n,isTranslationActive:t}}this.dispatchContextUpdateEvent(n),null===e&&void 0!==n.isTranslationActive&&this.saveTranslationSettingInAccount(n.isTranslationActive),i&&(n.isTranslationActive?a.a(this,s.w(i)):a.a(this,s.x(i))),sessionStorage.setItem(a.N.TranslationInitialized,Date.now().toString()),a.a(this,o.j(!!n.isTranslationActive))}getFallbackIsTranslationActive(){return this.defaultImmersiveOn?[!0,s.T.MULTILINGUAL_ON]:(this.isNewImmersiveVisit,this.isNewAccountAge?[!0,s.T.ACCOUNT_AGE]:[!1,s.T.DEFAULT_OFF])}syncTranslationSettingsWithCookie(){const t=this.fetchTranslationSettingFromCookie();let e={...this.translationContextValue};t&&t.isTranslationActive!==e.isTranslationActive&&(e={...e,...t},this.dispatchContextUpdateEvent(e)),a.a(this,o.j(!!e.isTranslationActive))}fetchTranslationSettingFromCookie(){const t=a.q.get(a.h3)??"";return a.h4(t)}async fetchTranslationSettingFromGQL(){if(!this.withBackendSetting)return null;try{const{data:t}=await this.requestClientGQL({operation:a.O.IdentityImmersiveTranslationSetting}),e=t.identity?.preferences?.isMachineTranslationImmersive;return null==e||e===a.gQ.Unset?null:e===a.gQ.Enabled}catch{}return null}async saveTranslationSettingInAccount(t){if(!this.withBackendSetting)return null;try{await this.requestClientGQL({operation:a.O.UpdateAccountPreferences,variables:{input:{isMachineTranslationImmersive:t?a.gQ.Enabled:a.gQ.Disabled}}})}catch{}return null}dispatchContextUpdateEvent(t){const e=new CustomEvent("update-translation-context",{bubbles:!0,composed:!0,detail:t});this.dispatchEvent(e)}isSettingInitialized(){const t=localStorage.getItem(a.N.LoginTime);if(t&&this.withBackendSetting){const e=new Date(t);if(Date.now()-e.getTime()<2e4)return!1}const e=sessionStorage.getItem(a.N.TranslationInitialized);return!!(e&&Date.now()-parseInt(e,10)<36e5)}render(){return t.x`<div> <slot></slot> </div>`}};t._([a.aq({context:a.as,subscribe:!0}),t.b()],v.prototype,"translationContextValue",void 0),t._([t.n({type:Boolean,attribute:"is-new-account-age"})],v.prototype,"isNewAccountAge",void 0),t._([t.n({type:Boolean,attribute:"is-new-immersive-visit"})],v.prototype,"isNewImmersiveVisit",void 0),t._([t.n({type:Boolean,attribute:"with-backend-setting"})],v.prototype,"withBackendSetting",void 0),t._([t.n({type:String,attribute:"preferred-languages"})],v.prototype,"preferredLanguages",void 0),t._([t.n({type:String,attribute:"full-preferred-languages"})],v.prototype,"fullPreferredLanguages",void 0),t._([t.n({type:Boolean,attribute:"default-immersive-on"})],v.prototype,"defaultImmersiveOn",void 0),v=t._([t.c("translation-settings-admin")],v)}));